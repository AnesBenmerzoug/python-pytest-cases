



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-4.6.3">
    
    
      
        <title>Advanced - pytest_cases</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#advanced-usage" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="pytest_cases" aria-label="pytest_cases" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              pytest_cases
            </span>
            <span class="md-header-nav__topic">
              
                Advanced
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/smarie/python-pytest-cases/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="pytest_cases" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    pytest_cases
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/smarie/python-pytest-cases/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Usage details
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Usage details
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../intermediate/" title="Intermediate" class="md-nav__link">
      Intermediate
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Advanced
      </label>
    
    <a href="./" title="Advanced" class="md-nav__link md-nav__link--active">
      Advanced
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#case-arguments" class="md-nav__link">
    Case arguments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reusing-cases-in-several-tests" class="md-nav__link">
    Reusing cases in several Tests
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-variants" class="md-nav__link">
    With variants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    Caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental-tests-with-pytest-steps" class="md-nav__link">
    Incremental tests with pytest-steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-if-steps-can-run-with-the-same-data" class="md-nav__link">
    1- If steps can run with the same data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-if-steps-require-different-data-a-dicts" class="md-nav__link">
    2- If steps require different data (A: dicts)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-if-steps-require-different-data-b-arguments-recommended" class="md-nav__link">
    3- If steps require different data (B: arguments, recommended)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-pytest-manual-parametrization" class="md-nav__link">
    Advanced Pytest: Manual parametrization
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../api_reference/" title="API reference" class="md-nav__link">
      API reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#case-arguments" class="md-nav__link">
    Case arguments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reusing-cases-in-several-tests" class="md-nav__link">
    Reusing cases in several Tests
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-variants" class="md-nav__link">
    With variants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    Caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental-tests-with-pytest-steps" class="md-nav__link">
    Incremental tests with pytest-steps
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-if-steps-can-run-with-the-same-data" class="md-nav__link">
    1- If steps can run with the same data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-if-steps-require-different-data-a-dicts" class="md-nav__link">
    2- If steps require different data (A: dicts)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-if-steps-require-different-data-b-arguments-recommended" class="md-nav__link">
    3- If steps require different data (B: arguments, recommended)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-pytest-manual-parametrization" class="md-nav__link">
    Advanced Pytest: Manual parametrization
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/smarie/python-pytest-cases/edit/master/docs/usage/advanced.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="advanced-usage">Advanced usage<a class="headerlink" href="#advanced-usage" title="Permanent link">&para;</a></h1>
<h2 id="case-arguments">Case arguments<a class="headerlink" href="#case-arguments" title="Permanent link">&para;</a></h2>
<p>Case functions can have arguments. This makes it very easy to combine test cases with more elaborate pytest concepts (fixtures, parameters):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">CaseData</span><span class="p">,</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span>

<span class="k">def</span> <span class="nf">case_simple</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using version &quot;</span> <span class="o">+</span> <span class="n">version</span><span class="p">)</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">case_simple2</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using version &quot;</span> <span class="o">+</span> <span class="n">version</span><span class="p">)</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># the order of the loops will be [for version] &gt; [for case]</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;2.0.0&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_with_parameters</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
    <span class="c1"># 1- Grab the test case data with the parameter</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="c1"># 2- Use it as usual...</span>
    <span class="c1"># ...</span>
</code></pre></div>


<p>This also works with case generators: simply add the argument(s) to the function signature, <em>without</em> declaring them in the <code>@cases_generator</code> decorator.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@cases_generator</span><span class="p">(</span><span class="s2">&quot;gen case i=</span><span class="si">{i}</span><span class="s2">, j=</span><span class="si">{j}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">case_gen</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using version &quot;</span> <span class="o">+</span> <span class="n">version</span><span class="p">)</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">j</span><span class="p">)</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>


<h2 id="reusing-cases-in-several-tests">Reusing cases in several Tests<a class="headerlink" href="#reusing-cases-in-several-tests" title="Permanent link">&para;</a></h2>
<p>You might wish to use the same test cases in several test functions. This works out of the box: simply refer to the same test case module in the <code>@case_data</code> decorator of several test functions, and you're set!</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span>

<span class="c1"># import the module containing the test cases</span>
<span class="kn">import</span> <span class="nn">test_foo_cases</span>


<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">test_foo_cases</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">):</span>
    <span class="c1"># 1- Grab the test case data</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># 2- Use it</span>
    <span class="c1"># ...</span>

<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">test_foo_cases</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Another test that uses exactly the same test case data than test_1 &quot;&quot;&quot;</span>
    <span class="c1"># 1- Grab the test case data</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># 2- Use it</span>
    <span class="c1"># ...</span>
</code></pre></div>


<h3 id="with-variants">With variants<a class="headerlink" href="#with-variants" title="Permanent link">&para;</a></h3>
<p>If the tests use the same shared cases but with small differences, you may wish to add <a href="#case_arguments">arguments</a> to your case functions.</p>
<h3 id="caching">Caching<a class="headerlink" href="#caching" title="Permanent link">&para;</a></h3>
<p>After starting to reuse cases in several test functions, you might end-up thinking <em>"why do I have to spend the data parsing/generation time several times ? It is the same case."</em>. You can solve this issue by using a cache.</p>
<p>For simple cases you can simply decorate your case function with <code>@lru_cache(maxsize=1)</code> since simple case functions do not have arguments:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case_a</span><span class="p">():</span>
    <span class="c1"># ... (as usual)</span>
</code></pre></div>


<p>For case generators you <strong>can</strong> also use <code>@lru_cache(maxsize=x)</code>, but you will have to set the max size according to the number of generated cases (or <code>None</code> to allow auto-grow). This can be automated: simply use the <code>lru_cache=True</code> parameter and <code>pytest-cases</code> will do it for you:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">CaseData</span><span class="p">,</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> \
  <span class="n">cases_generator</span>

<span class="c1"># ----------------------CASES--------------------------</span>
<span class="c1"># case generator with caching enabled</span>
<span class="nd">@cases_generator</span><span class="p">(</span><span class="s2">&quot;case </span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">lru_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case_gen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;generating case &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">outs</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="n">err</span>

<span class="c1"># ----------------------TESTS--------------------------</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_a</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">):</span>
    <span class="c1"># 1- Grab the test case data</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># 2- Use it</span>
    <span class="o">...</span>


<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_b</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">):</span>
    <span class="c1"># 1- Grab the test case data</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># 2- Use it</span>
    <span class="o">...</span>
</code></pre></div>


<p>yields:</p>
<div class="codehilite"><pre><span></span><code><span class="o">=============================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================</span>
...
collecting ... collected <span class="m">6</span> items
test_memoize_generators.py::test_a<span class="o">[</span><span class="k">case</span> <span class="m">0</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">16</span>%<span class="o">]</span>generating <span class="k">case</span> <span class="m">0</span>
<span class="m">0</span>
test_memoize_generators.py::test_a<span class="o">[</span><span class="k">case</span> <span class="m">1</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">33</span>%<span class="o">]</span>generating <span class="k">case</span> <span class="m">1</span>
<span class="m">1</span>
test_memoize_generators.py::test_a<span class="o">[</span><span class="k">case</span> <span class="m">2</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">50</span>%<span class="o">]</span>generating <span class="k">case</span> <span class="m">2</span>
<span class="m">2</span>
test_memoize_generators.py::test_b<span class="o">[</span><span class="k">case</span> <span class="m">0</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">66</span>%<span class="o">]</span><span class="m">0</span>
test_memoize_generators.py::test_b<span class="o">[</span><span class="k">case</span> <span class="m">1</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">83</span>%<span class="o">]</span><span class="m">1</span>
test_memoize_generators.py::test_b<span class="o">[</span><span class="k">case</span> <span class="m">2</span><span class="o">]</span> PASSED <span class="o">[</span><span class="m">100</span>%<span class="o">]</span><span class="nv">2</span>
<span class="o">==========================</span> <span class="m">6</span> passed in <span class="m">0</span>.16 <span class="nv">seconds</span> <span class="o">===========================</span>
</code></pre></div>


<p>You can see that the second time each case is needed, the cached value is used instead of executing the case generation function again.</p>
<p>See <a href="https://docs.python.org/3/library/functools.html#functools.lru_cache">doc on lru_cache</a> for implementation details.</p>
<p><strong>WARNING</strong> if you use <a href="#case_arguments">case arguments</a>, do not forget to take the additional parameter values into account to estimate the total cache size. Note that the <code>lru_cache=</code> option of <code>@cases_generator</code> is not intelligent enough to handle additional arguments: do not use it, and instead manually apply the <code>@lru_cache</code> decorator.</p>
<h2 id="incremental-tests-with-pytest-steps">Incremental tests with <a href="https://smarie.github.io/python-pytest-steps/">pytest-steps</a><a class="headerlink" href="#incremental-tests-with-pytest-steps" title="Permanent link">&para;</a></h2>
<p>Sometimes you wish to execute a series of test steps on the same dataset, and then to move to another one. There are many ways to do this with <code>pytest</code> but some of them are not easy to blend with the notion of 'cases' in an intuitive manner. <code>pytest-cases</code> is compliant with <a href="https://smarie.github.io/python-pytest-steps/">pytest-steps</a>: you can easily create incremental tests and throw your cases on them.</p>
<p>This tutorial assumes that you are already familiar with <a href="https://smarie.github.io/python-pytest-steps/">pytest-steps</a>.</p>
<h3 id="1-if-steps-can-run-with-the-same-data">1- If steps can run with the same data<a class="headerlink" href="#1-if-steps-can-run-with-the-same-data" title="Permanent link">&para;</a></h3>
<p>If all of the test steps require the same data to execute, it is straightforward, both in parametrizer mode (shown below) or in the new pytest steps generator mode (not shown):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> <span class="n">CaseData</span>
<span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="c1"># -------- test cases</span>
<span class="k">def</span> <span class="nf">case_simple</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">case_simple2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># ------- test steps</span>
<span class="k">def</span> <span class="nf">step_a</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step a of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also store intermediate results in steps_data</span>

<span class="k">def</span> <span class="nf">step_b</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step b of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also retrieve intermediate results from steps_data</span>

<span class="c1"># ------- test suite</span>
<span class="nd">@test_steps</span><span class="p">(</span><span class="n">step_a</span><span class="p">,</span> <span class="n">step_b</span><span class="p">)</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">steps_data</span><span class="p">):</span>
    <span class="c1"># Get the data for this step</span>
    <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># Execute the step</span>
    <span class="n">test_step</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">)</span>
</code></pre></div>


<p>This yields:</p>
<div class="codehilite"><pre><span></span><code><span class="o">=============================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================</span>
...
test_p.py::test_suite<span class="o">[</span>case_simple-step_a<span class="o">]</span> PASSED  <span class="o">[</span> <span class="m">25</span>%<span class="o">]{</span><span class="s1">&#39;a&#39;</span>: <span class="m">1</span>, <span class="s1">&#39;b&#39;</span>: <span class="m">2</span><span class="o">}</span>
test_p.py::test_suite<span class="o">[</span>case_simple-step_b<span class="o">]</span> PASSED  <span class="o">[</span> <span class="m">50</span>%<span class="o">]{</span><span class="s1">&#39;a&#39;</span>: <span class="m">1</span>, <span class="s1">&#39;b&#39;</span>: <span class="m">2</span><span class="o">}</span>
test_p.py::test_suite<span class="o">[</span>case_simple2-step_a<span class="o">]</span> PASSED <span class="o">[</span> <span class="m">75</span>%<span class="o">]{</span><span class="s1">&#39;a&#39;</span>: -1, <span class="s1">&#39;b&#39;</span>: <span class="m">2</span><span class="o">}</span>
test_p.py::test_suite<span class="o">[</span>case_simple2-step_b<span class="o">]</span> PASSED <span class="o">[</span><span class="m">100</span>%<span class="o">]{</span><span class="s1">&#39;a&#39;</span>: -1, <span class="s1">&#39;b&#39;</span>: <span class="m">2</span><span class="o">}</span>
<span class="o">==========================</span> <span class="m">4</span> passed in <span class="m">0</span>.13 <span class="nv">seconds</span> <span class="o">===========================</span>
</code></pre></div>


<p>You see that for each case data, all steps are executed in order. If you use an IDE it will appear in this intuitive order too:</p>
<div class="codehilite"><pre><span></span><code>case_simple
 - step_a
 - step_b
case_simple2
 - step_a
 - step_b
</code></pre></div>


<p>If for some reason you wish to invert the order (executing all cases on step a then all cases on step b etc.) simply invert the order of decorators and it will work (<code>pytest</code> is great!). This is not recommended though, as it is a lot less intuitive.</p>
<p>Of course you might want to <a href="#caching">enable caching</a> so that the cases will be read only once, and not once for each test step.</p>
<h3 id="2-if-steps-require-different-data-a-dicts">2- If steps require different data (A: dicts)<a class="headerlink" href="#2-if-steps-require-different-data-a-dicts" title="Permanent link">&para;</a></h3>
<p>In real-world usage, each step will probably have different expected output or errors for the same case - except if the steps are very similar. The steps may even need slightly different input, for example the same dataset but in two different formats.</p>
<p>This is actually quite straightforward: simply adapt your custom case data format definition! Since <code>pytest-cases</code> does not impose <strong>any</strong> format for your case functions outputs, you can decide that your case functions return lists, dictionaries, etc.</p>
<p>For example you can choose the format proposed by the <code>MultipleStepsCaseData</code> type hint, where each item in the returned inputs/outputs/errors tuple can either be a single element, or a dictionary of name -&gt; element. This allows your case functions to return alternate contents depending on the test step being executed.</p>
<p>The example below shows a test suite where the inputs of the steps are the same, but the outputs and expected errors are different. Note that once again the example relies on the legacy "parametrizer" mode of pytest-steps, but it would be similar with the new "generator" mode.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> \
  <span class="n">MultipleStepsCaseData</span>
<span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="c1"># -------- test cases</span>
<span class="k">def</span> <span class="nf">case_simple</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MultipleStepsCaseData</span><span class="p">:</span>
    <span class="c1"># common input</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># one expected output for each step</span>
    <span class="n">outs_for_a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="n">outs_for_b</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">step_check_a</span><span class="o">=</span><span class="n">outs_for_a</span><span class="p">,</span> <span class="n">step_check_b</span><span class="o">=</span><span class="n">outs_for_b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">case_simple2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MultipleStepsCaseData</span><span class="p">:</span>
    <span class="c1"># common input</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># one expected output for each step</span>
    <span class="n">outs_for_a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="n">outs_for_b</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">step_check_a</span><span class="o">=</span><span class="n">outs_for_a</span><span class="p">,</span> <span class="n">step_check_b</span><span class="o">=</span><span class="n">outs_for_b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># ------- test steps</span>
<span class="k">def</span> <span class="nf">step_check_a</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step a of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also store intermediate results in steps_data</span>

<span class="k">def</span> <span class="nf">step_check_b</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step b of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also retrieve intermediate results from steps_data</span>

<span class="c1"># ------- test suite</span>
<span class="nd">@test_steps</span><span class="p">(</span><span class="n">step_check_a</span><span class="p">,</span> <span class="n">step_check_b</span><span class="p">)</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">steps_data</span><span class="p">):</span>
    <span class="c1"># Get the case data for all steps (sad...)</span>
    <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># Filter it, based on the step name</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">test_step</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">expected_o</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">expected_o</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">expected_o</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">expected_e</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">expected_e</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">expected_e</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Execute the step</span>
    <span class="n">test_step</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">)</span>
</code></pre></div>


<p>There are two main differences with the previous example:</p>
<ul>
<li>in the <code>case_simple</code> and <code>case_simple2</code> case functions, we choose to provide the expected output and expected error as <strong>dictionaries indexed by the test step name</strong> when they are non-<code>None</code>. We also choose that the input is the same for all steps, but we could have done otherwise - using a dictionary with step name keys as well.</li>
<li>in the final <code>test_suite</code> we use the test step name dictionary key to get the case data contents <strong>for a given step</strong>.</li>
</ul>
<p>Once again you might want to <a href="#caching">enable caching</a> in order for the cases to be read only once, and not once for each test step.</p>
<h3 id="3-if-steps-require-different-data-b-arguments-recommended">3- If steps require different data (B: arguments, recommended)<a class="headerlink" href="#3-if-steps-require-different-data-b-arguments-recommended" title="Permanent link">&para;</a></h3>
<p>The above example might seem a bit disappointing as it breaks the philosophy of doing each data access <strong>only when it is needed</strong>. Indeed everytime a single step is run it actually gets the data for all steps and then has to do some filtering.</p>
<p>The style suggested below, making use of <a href="./advanced#case_arguments">case arguments</a>, is probably better: </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> <span class="n">CaseData</span>
<span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="c1"># -------- test cases</span>
<span class="k">def</span> <span class="nf">case_simple</span><span class="p">(</span><span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="c1"># reuse the same input whatever the step</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># adapt the expected output to the current step</span>
    <span class="k">if</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_a&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_b&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">case_simple2</span><span class="p">(</span><span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="c1"># reuse the same input whatever the step</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># adapt the expected output to the current step</span>
    <span class="k">if</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_a&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_b&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># ------- test steps</span>
<span class="k">def</span> <span class="nf">step_check_a</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step a of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also store intermediate results in steps_data</span>

<span class="k">def</span> <span class="nf">step_check_b</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step b of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also retrieve intermediate results from steps_data</span>

<span class="c1"># ------- test suite</span>
<span class="nd">@test_steps</span><span class="p">(</span><span class="n">step_check_a</span><span class="p">,</span> <span class="n">step_check_b</span><span class="p">)</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">steps_data</span><span class="p">):</span>

    <span class="c1"># Get the data for this particular case</span>
    <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">test_step</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># Execute the step</span>
    <span class="n">test_step</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">)</span>
</code></pre></div>


<p>Notice that now <strong>the test step name is a parameter of the case function</strong>. So for each step, only the data relevant to this step is retrieved. </p>
<p>Once again you might want to enable caching in order for the cases to be read only once, and not once for each test step. However since the case functions now have arguments, you should <strong>not</strong> use <code>@lru_cache()</code> directly on the case function but you should put it in a separate subfunction:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">CaseData</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">input_for_case_simple</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">case_simple</span><span class="p">(</span><span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="c1"># reuse the same input whatever the step</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="n">input_for_case_simple</span><span class="p">()</span>

    <span class="c1"># adapt the expected output to the current step</span>
    <span class="k">if</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_a&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_b&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>


<p>That way, <code>input_for_case_simple</code> will be cached across the steps.</p>
<p>See <a href="#caching">caching</a> for details.</p>
<h2 id="advanced-pytest-manual-parametrization">Advanced Pytest: Manual parametrization<a class="headerlink" href="#advanced-pytest-manual-parametrization" title="Permanent link">&para;</a></h2>
<p>The <code>@cases_data</code> decorator is just syntactic sugar for the following two-steps process, that you may wish to rely on for advanced pytest usages:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">get_all_cases</span><span class="p">,</span> <span class="n">get_pytest_parametrize_args</span>

<span class="c1"># import the module containing the test cases</span>
<span class="kn">import</span> <span class="nn">test_foo_cases</span>

<span class="c1"># manually list the available cases</span>
<span class="n">cases</span> <span class="o">=</span> <span class="n">get_all_cases</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">test_foo_cases</span><span class="p">)</span>

<span class="c1"># transform into required arguments for pytest (applying the pytest marks if needed)</span>
<span class="n">marked_cases</span><span class="p">,</span> <span class="n">cases_ids</span> <span class="o">=</span> <span class="n">get_pytest_parametrize_args</span><span class="p">(</span><span class="n">cases</span><span class="p">)</span>

<span class="c1"># parametrize the test function manually</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;case_data&#39;</span><span class="p">,</span> <span class="n">marked_cases</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="n">cases_ids</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_cases_decorated</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../intermediate/" title="Intermediate" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Intermediate
              </span>
            </div>
          </a>
        
        
          <a href="../../api_reference/" title="API reference" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                API reference
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.1",url:{base:"../.."}})</script>
      
    
  </body>
</html>