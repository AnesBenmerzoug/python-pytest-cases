


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>Advanced - pytest_cases</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a2408e81.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="pytest_cases" class="md-header-nav__button md-logo" aria-label="pytest_cases">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            pytest_cases
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Advanced
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/smarie/python-pytest-cases/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="pytest_cases" class="md-nav__button md-logo" aria-label="pytest_cases">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    pytest_cases
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/smarie/python-pytest-cases/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Usage details
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Usage details" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Usage details
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../basics/" title="Basics" class="md-nav__link">
      Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../intermediate/" title="Intermediate" class="md-nav__link">
      Intermediate
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Advanced
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Advanced" class="md-nav__link md-nav__link--active">
      Advanced
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#case-arguments" class="md-nav__link">
    Case arguments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reusing-cases-in-several-tests" class="md-nav__link">
    Reusing cases in several Tests
  </a>
  
    <nav class="md-nav" aria-label="Reusing cases in several Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-variants" class="md-nav__link">
    With variants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    Caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental-tests-with-pytest-steps" class="md-nav__link">
    Incremental tests with pytest-steps
  </a>
  
    <nav class="md-nav" aria-label="Incremental tests with pytest-steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-if-steps-can-run-with-the-same-data" class="md-nav__link">
    1- If steps can run with the same data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-if-steps-require-different-data-a-dicts" class="md-nav__link">
    2- If steps require different data (A: dicts)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-if-steps-require-different-data-b-arguments-recommended" class="md-nav__link">
    3- If steps require different data (B: arguments, recommended)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-pytest-manual-parametrization" class="md-nav__link">
    Advanced Pytest: Manual parametrization
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../api_reference/" title="API reference" class="md-nav__link">
      API reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#case-arguments" class="md-nav__link">
    Case arguments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reusing-cases-in-several-tests" class="md-nav__link">
    Reusing cases in several Tests
  </a>
  
    <nav class="md-nav" aria-label="Reusing cases in several Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#with-variants" class="md-nav__link">
    With variants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caching" class="md-nav__link">
    Caching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incremental-tests-with-pytest-steps" class="md-nav__link">
    Incremental tests with pytest-steps
  </a>
  
    <nav class="md-nav" aria-label="Incremental tests with pytest-steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-if-steps-can-run-with-the-same-data" class="md-nav__link">
    1- If steps can run with the same data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-if-steps-require-different-data-a-dicts" class="md-nav__link">
    2- If steps require different data (A: dicts)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-if-steps-require-different-data-b-arguments-recommended" class="md-nav__link">
    3- If steps require different data (B: arguments, recommended)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-pytest-manual-parametrization" class="md-nav__link">
    Advanced Pytest: Manual parametrization
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/smarie/python-pytest-cases/edit/master/docs/usage/advanced.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="advanced-usage">Advanced usage<a class="headerlink" href="#advanced-usage" title="Permanent link">&para;</a></h1>
<h2 id="case-arguments">Case arguments<a class="headerlink" href="#case-arguments" title="Permanent link">&para;</a></h2>
<p>Case functions can have arguments. This makes it very easy to combine test cases with more elaborate pytest concepts (fixtures, parameters):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">CaseData</span><span class="p">,</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span>

<span class="k">def</span> <span class="nf">case_simple</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using version &quot;</span> <span class="o">+</span> <span class="n">version</span><span class="p">)</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">case_simple2</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using version &quot;</span> <span class="o">+</span> <span class="n">version</span><span class="p">)</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># the order of the loops will be [for version] &gt; [for case]</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span> <span class="s2">&quot;2.0.0&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">test_with_parameters</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
    <span class="c1"># 1- Grab the test case data with the parameter</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

    <span class="c1"># 2- Use it as usual...</span>
    <span class="c1"># ...</span>
</code></pre></div>


<p>This also works with case generators: simply add the argument(s) to the function signature, <em>without</em> declaring them in the <code>@cases_generator</code> decorator.</p>
<div class="codehilite"><pre><span></span><code><span class="nd">@cases_generator</span><span class="p">(</span><span class="s2">&quot;gen case i=</span><span class="si">{i}</span><span class="s2">, j=</span><span class="si">{j}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">case_gen</span><span class="p">(</span><span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;using version &quot;</span> <span class="o">+</span> <span class="n">version</span><span class="p">)</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">j</span><span class="p">)</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>


<h2 id="reusing-cases-in-several-tests">Reusing cases in several Tests<a class="headerlink" href="#reusing-cases-in-several-tests" title="Permanent link">&para;</a></h2>
<p>You might wish to use the same test cases in several test functions. This works out of the box: simply refer to the same test case module in the <code>@case_data</code> decorator of several test functions, and you're set!</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span>

<span class="c1"># import the module containing the test cases</span>
<span class="kn">import</span> <span class="nn">test_foo_cases</span>


<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">test_foo_cases</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_1</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">):</span>
    <span class="c1"># 1- Grab the test case data</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># 2- Use it</span>
    <span class="c1"># ...</span>

<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">test_foo_cases</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_2</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Another test that uses exactly the same test case data than test_1 &quot;&quot;&quot;</span>
    <span class="c1"># 1- Grab the test case data</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># 2- Use it</span>
    <span class="c1"># ...</span>
</code></pre></div>


<h3 id="with-variants">With variants<a class="headerlink" href="#with-variants" title="Permanent link">&para;</a></h3>
<p>If the tests use the same shared cases but with small differences, you may wish to add <a href="#case_arguments">arguments</a> to your case functions.</p>
<h3 id="caching">Caching<a class="headerlink" href="#caching" title="Permanent link">&para;</a></h3>
<p>After starting to reuse cases in several test functions, you might end-up thinking <em>"why do I have to spend the data parsing/generation time several times ? It is the same case."</em>. You can solve this issue by using a cache.</p>
<p>For simple cases you can simply decorate your case function with <code>@lru_cache(maxsize=1)</code> since simple case functions do not have arguments:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case_a</span><span class="p">():</span>
    <span class="c1"># ... (as usual)</span>
</code></pre></div>


<p>For case generators you <strong>can</strong> also use <code>@lru_cache(maxsize=x)</code>, but you will have to set the max size according to the number of generated cases (or <code>None</code> to allow auto-grow). This can be automated: simply use the <code>lru_cache=True</code> parameter and <code>pytest-cases</code> will do it for you:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">CaseData</span><span class="p">,</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> \
  <span class="n">cases_generator</span>

<span class="c1"># ----------------------CASES--------------------------</span>
<span class="c1"># case generator with caching enabled</span>
<span class="nd">@cases_generator</span><span class="p">(</span><span class="s2">&quot;case </span><span class="si">{i}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">lru_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case_gen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;generating case &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">outs</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="n">err</span>

<span class="c1"># ----------------------TESTS--------------------------</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_a</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">):</span>
    <span class="c1"># 1- Grab the test case data</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># 2- Use it</span>
    <span class="o">...</span>


<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_b</span><span class="p">(</span><span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">):</span>
    <span class="c1"># 1- Grab the test case data</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># 2- Use it</span>
    <span class="o">...</span>
</code></pre></div>


<p>yields:</p>
<div class="codehilite"><pre><span></span><code><span class="o">=============================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================</span>
...
collecting ... collected <span class="m">6</span> items
test_memoize_generators.py::test_a<span class="o">[</span><span class="k">case</span> <span class="m">0</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">16</span>%<span class="o">]</span>generating <span class="k">case</span> <span class="m">0</span>
<span class="m">0</span>
test_memoize_generators.py::test_a<span class="o">[</span><span class="k">case</span> <span class="m">1</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">33</span>%<span class="o">]</span>generating <span class="k">case</span> <span class="m">1</span>
<span class="m">1</span>
test_memoize_generators.py::test_a<span class="o">[</span><span class="k">case</span> <span class="m">2</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">50</span>%<span class="o">]</span>generating <span class="k">case</span> <span class="m">2</span>
<span class="m">2</span>
test_memoize_generators.py::test_b<span class="o">[</span><span class="k">case</span> <span class="m">0</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">66</span>%<span class="o">]</span><span class="m">0</span>
test_memoize_generators.py::test_b<span class="o">[</span><span class="k">case</span> <span class="m">1</span><span class="o">]</span> PASSED <span class="o">[</span> <span class="m">83</span>%<span class="o">]</span><span class="m">1</span>
test_memoize_generators.py::test_b<span class="o">[</span><span class="k">case</span> <span class="m">2</span><span class="o">]</span> PASSED <span class="o">[</span><span class="m">100</span>%<span class="o">]</span><span class="nv">2</span>
<span class="o">==========================</span> <span class="m">6</span> passed in <span class="m">0</span>.16 <span class="nv">seconds</span> <span class="o">===========================</span>
</code></pre></div>


<p>You can see that the second time each case is needed, the cached value is used instead of executing the case generation function again.</p>
<p>See <a href="https://docs.python.org/3/library/functools.html#functools.lru_cache">doc on lru_cache</a> for implementation details.</p>
<p><strong>WARNING</strong> if you use <a href="#case_arguments">case arguments</a>, do not forget to take the additional parameter values into account to estimate the total cache size. Note that the <code>lru_cache=</code> option of <code>@cases_generator</code> is not intelligent enough to handle additional arguments: do not use it, and instead manually apply the <code>@lru_cache</code> decorator.</p>
<h2 id="incremental-tests-with-pytest-steps">Incremental tests with <a href="https://smarie.github.io/python-pytest-steps/">pytest-steps</a><a class="headerlink" href="#incremental-tests-with-pytest-steps" title="Permanent link">&para;</a></h2>
<p>Sometimes you wish to execute a series of test steps on the same dataset, and then to move to another one. There are many ways to do this with <code>pytest</code> but some of them are not easy to blend with the notion of 'cases' in an intuitive manner. <code>pytest-cases</code> is compliant with <a href="https://smarie.github.io/python-pytest-steps/">pytest-steps</a>: you can easily create incremental tests and throw your cases on them.</p>
<p>This tutorial assumes that you are already familiar with <a href="https://smarie.github.io/python-pytest-steps/">pytest-steps</a>.</p>
<h3 id="1-if-steps-can-run-with-the-same-data">1- If steps can run with the same data<a class="headerlink" href="#1-if-steps-can-run-with-the-same-data" title="Permanent link">&para;</a></h3>
<p>If all of the test steps require the same data to execute, it is straightforward, both in parametrizer mode (shown below) or in the new pytest steps generator mode (not shown):</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> <span class="n">CaseData</span>
<span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="c1"># -------- test cases</span>
<span class="k">def</span> <span class="nf">case_simple</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">case_simple2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># ------- test steps</span>
<span class="k">def</span> <span class="nf">step_a</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step a of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also store intermediate results in steps_data</span>

<span class="k">def</span> <span class="nf">step_b</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step b of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also retrieve intermediate results from steps_data</span>

<span class="c1"># ------- test suite</span>
<span class="nd">@test_steps</span><span class="p">(</span><span class="n">step_a</span><span class="p">,</span> <span class="n">step_b</span><span class="p">)</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">steps_data</span><span class="p">):</span>
    <span class="c1"># Get the data for this step</span>
    <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># Execute the step</span>
    <span class="n">test_step</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">)</span>
</code></pre></div>


<p>This yields:</p>
<div class="codehilite"><pre><span></span><code><span class="o">=============================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=============================</span>
...
test_p.py::test_suite<span class="o">[</span>case_simple-step_a<span class="o">]</span> PASSED  <span class="o">[</span> <span class="m">25</span>%<span class="o">]{</span><span class="s1">&#39;a&#39;</span>: <span class="m">1</span>, <span class="s1">&#39;b&#39;</span>: <span class="m">2</span><span class="o">}</span>
test_p.py::test_suite<span class="o">[</span>case_simple-step_b<span class="o">]</span> PASSED  <span class="o">[</span> <span class="m">50</span>%<span class="o">]{</span><span class="s1">&#39;a&#39;</span>: <span class="m">1</span>, <span class="s1">&#39;b&#39;</span>: <span class="m">2</span><span class="o">}</span>
test_p.py::test_suite<span class="o">[</span>case_simple2-step_a<span class="o">]</span> PASSED <span class="o">[</span> <span class="m">75</span>%<span class="o">]{</span><span class="s1">&#39;a&#39;</span>: -1, <span class="s1">&#39;b&#39;</span>: <span class="m">2</span><span class="o">}</span>
test_p.py::test_suite<span class="o">[</span>case_simple2-step_b<span class="o">]</span> PASSED <span class="o">[</span><span class="m">100</span>%<span class="o">]{</span><span class="s1">&#39;a&#39;</span>: -1, <span class="s1">&#39;b&#39;</span>: <span class="m">2</span><span class="o">}</span>
<span class="o">==========================</span> <span class="m">4</span> passed in <span class="m">0</span>.13 <span class="nv">seconds</span> <span class="o">===========================</span>
</code></pre></div>


<p>You see that for each case data, all steps are executed in order. If you use an IDE it will appear in this intuitive order too:</p>
<div class="codehilite"><pre><span></span><code>case_simple
 - step_a
 - step_b
case_simple2
 - step_a
 - step_b
</code></pre></div>


<p>If for some reason you wish to invert the order (executing all cases on step a then all cases on step b etc.) simply invert the order of decorators and it will work (<code>pytest</code> is great!). This is not recommended though, as it is a lot less intuitive.</p>
<p>Of course you might want to <a href="#caching">enable caching</a> so that the cases will be read only once, and not once for each test step.</p>
<h3 id="2-if-steps-require-different-data-a-dicts">2- If steps require different data (A: dicts)<a class="headerlink" href="#2-if-steps-require-different-data-a-dicts" title="Permanent link">&para;</a></h3>
<p>In real-world usage, each step will probably have different expected output or errors for the same case - except if the steps are very similar. The steps may even need slightly different input, for example the same dataset but in two different formats.</p>
<p>This is actually quite straightforward: simply adapt your custom case data format definition! Since <code>pytest-cases</code> does not impose <strong>any</strong> format for your case functions outputs, you can decide that your case functions return lists, dictionaries, etc.</p>
<p>For example you can choose the format proposed by the <code>MultipleStepsCaseData</code> type hint, where each item in the returned inputs/outputs/errors tuple can either be a single element, or a dictionary of name -&gt; element. This allows your case functions to return alternate contents depending on the test step being executed.</p>
<p>The example below shows a test suite where the inputs of the steps are the same, but the outputs and expected errors are different. Note that once again the example relies on the legacy "parametrizer" mode of pytest-steps, but it would be similar with the new "generator" mode.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> \
  <span class="n">MultipleStepsCaseData</span>
<span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="c1"># -------- test cases</span>
<span class="k">def</span> <span class="nf">case_simple</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MultipleStepsCaseData</span><span class="p">:</span>
    <span class="c1"># common input</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># one expected output for each step</span>
    <span class="n">outs_for_a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="n">outs_for_b</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">step_check_a</span><span class="o">=</span><span class="n">outs_for_a</span><span class="p">,</span> <span class="n">step_check_b</span><span class="o">=</span><span class="n">outs_for_b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">case_simple2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">MultipleStepsCaseData</span><span class="p">:</span>
    <span class="c1"># common input</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># one expected output for each step</span>
    <span class="n">outs_for_a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="n">outs_for_b</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>
    <span class="n">outs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">step_check_a</span><span class="o">=</span><span class="n">outs_for_a</span><span class="p">,</span> <span class="n">step_check_b</span><span class="o">=</span><span class="n">outs_for_b</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># ------- test steps</span>
<span class="k">def</span> <span class="nf">step_check_a</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step a of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also store intermediate results in steps_data</span>

<span class="k">def</span> <span class="nf">step_check_b</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step b of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also retrieve intermediate results from steps_data</span>

<span class="c1"># ------- test suite</span>
<span class="nd">@test_steps</span><span class="p">(</span><span class="n">step_check_a</span><span class="p">,</span> <span class="n">step_check_b</span><span class="p">)</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">steps_data</span><span class="p">):</span>
    <span class="c1"># Get the case data for all steps (sad...)</span>
    <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="c1"># Filter it, based on the step name</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">test_step</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">expected_o</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">expected_o</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">expected_o</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">expected_e</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">expected_e</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">expected_e</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Execute the step</span>
    <span class="n">test_step</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">)</span>
</code></pre></div>


<p>There are two main differences with the previous example:</p>
<ul>
<li>in the <code>case_simple</code> and <code>case_simple2</code> case functions, we choose to provide the expected output and expected error as <strong>dictionaries indexed by the test step name</strong> when they are non-<code>None</code>. We also choose that the input is the same for all steps, but we could have done otherwise - using a dictionary with step name keys as well.</li>
<li>in the final <code>test_suite</code> we use the test step name dictionary key to get the case data contents <strong>for a given step</strong>.</li>
</ul>
<p>Once again you might want to <a href="#caching">enable caching</a> in order for the cases to be read only once, and not once for each test step.</p>
<h3 id="3-if-steps-require-different-data-b-arguments-recommended">3- If steps require different data (B: arguments, recommended)<a class="headerlink" href="#3-if-steps-require-different-data-b-arguments-recommended" title="Permanent link">&para;</a></h3>
<p>The above example might seem a bit disappointing as it breaks the philosophy of doing each data access <strong>only when it is needed</strong>. Indeed everytime a single step is run it actually gets the data for all steps and then has to do some filtering.</p>
<p>The style suggested below, making use of <a href="./advanced#case_arguments">case arguments</a>, is probably better: </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">cases_data</span><span class="p">,</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> <span class="n">CaseData</span>
<span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>

<span class="c1"># -------- test cases</span>
<span class="k">def</span> <span class="nf">case_simple</span><span class="p">(</span><span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="c1"># reuse the same input whatever the step</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># adapt the expected output to the current step</span>
    <span class="k">if</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_a&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_b&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">case_simple2</span><span class="p">(</span><span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="c1"># reuse the same input whatever the step</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># adapt the expected output to the current step</span>
    <span class="k">if</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_a&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_b&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># ------- test steps</span>
<span class="k">def</span> <span class="nf">step_check_a</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step a of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also store intermediate results in steps_data</span>

<span class="k">def</span> <span class="nf">step_check_b</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Step b of the test &quot;&quot;&quot;</span>
    <span class="c1"># Use the three items as usual</span>
    <span class="o">...</span>
    <span class="c1"># You can also retrieve intermediate results from steps_data</span>

<span class="c1"># ------- test suite</span>
<span class="nd">@test_steps</span><span class="p">(</span><span class="n">step_check_a</span><span class="p">,</span> <span class="n">step_check_b</span><span class="p">)</span>
<span class="nd">@cases_data</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">THIS_MODULE</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_suite</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">case_data</span><span class="p">:</span> <span class="n">CaseDataGetter</span><span class="p">,</span> <span class="n">steps_data</span><span class="p">):</span>

    <span class="c1"># Get the data for this particular case</span>
    <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span> <span class="o">=</span> <span class="n">case_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">test_step</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># Execute the step</span>
    <span class="n">test_step</span><span class="p">(</span><span class="n">steps_data</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">expected_o</span><span class="p">,</span> <span class="n">expected_e</span><span class="p">)</span>
</code></pre></div>


<p>Notice that now <strong>the test step name is a parameter of the case function</strong>. So for each step, only the data relevant to this step is retrieved. </p>
<p>Once again you might want to enable caching in order for the cases to be read only once, and not once for each test step. However since the case functions now have arguments, you should <strong>not</strong> use <code>@lru_cache()</code> directly on the case function but you should put it in a separate subfunction:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">CaseData</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>

<span class="nd">@lru_cache</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">input_for_case_simple</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">case_simple</span><span class="p">(</span><span class="n">step_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CaseData</span><span class="p">:</span>
    <span class="c1"># reuse the same input whatever the step</span>
    <span class="n">ins</span> <span class="o">=</span> <span class="n">input_for_case_simple</span><span class="p">()</span>

    <span class="c1"># adapt the expected output to the current step</span>
    <span class="k">if</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_a&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">step_name</span> <span class="o">==</span> <span class="s1">&#39;step_check_b&#39;</span><span class="p">:</span>
        <span class="n">outs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span>

    <span class="k">return</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div>


<p>That way, <code>input_for_case_simple</code> will be cached across the steps.</p>
<p>See <a href="#caching">caching</a> for details.</p>
<h2 id="advanced-pytest-manual-parametrization">Advanced Pytest: Manual parametrization<a class="headerlink" href="#advanced-pytest-manual-parametrization" title="Permanent link">&para;</a></h2>
<p>The <code>@cases_data</code> decorator is just syntactic sugar for the following two-steps process, that you may wish to rely on for advanced pytest usages:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pytest</span>
<span class="kn">from</span> <span class="nn">pytest_cases</span> <span class="kn">import</span> <span class="n">get_all_cases</span><span class="p">,</span> <span class="n">get_pytest_parametrize_args</span>

<span class="c1"># import the module containing the test cases</span>
<span class="kn">import</span> <span class="nn">test_foo_cases</span>

<span class="c1"># manually list the available cases</span>
<span class="n">cases</span> <span class="o">=</span> <span class="n">get_all_cases</span><span class="p">(</span><span class="n">module</span><span class="o">=</span><span class="n">test_foo_cases</span><span class="p">)</span>

<span class="c1"># transform into required arguments for pytest (applying the pytest marks if needed)</span>
<span class="n">marked_cases</span><span class="p">,</span> <span class="n">cases_ids</span> <span class="o">=</span> <span class="n">get_pytest_parametrize_args</span><span class="p">(</span><span class="n">cases</span><span class="p">)</span>

<span class="c1"># parametrize the test function manually</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;case_data&#39;</span><span class="p">,</span> <span class="n">marked_cases</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="n">cases_ids</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_with_cases_decorated</span><span class="p">(</span><span class="n">case_data</span><span class="p">):</span>
    <span class="o">...</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../intermediate/" title="Intermediate" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Intermediate
              </div>
            </div>
          </a>
        
        
          <a href="../../api_reference/" title="API reference" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                API reference
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"search.result.none": "No matching documents", "clipboard.copied": "Copied to clipboard", "search.result.other": "# matching documents", "search.config.pipeline": "trimmer, stopWordFilter", "search.result.one": "1 matching document", "search.result.placeholder": "Type to start searching", "search.config.lang": "en", "search.config.separator": "[\\s\\-]+", "clipboard.copy": "Copy to clipboard"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>